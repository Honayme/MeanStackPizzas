<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Controller/ingredientController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Controller/ingredientController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
 /**
 * Ingredient Controller
 * @module ControllerIngredient
 * @requires pizzaSchema
 * @requires ServerEvent
 * @requires express
 */
 
// Get schemas
const ingredientSchema = require('../Model/ingredientSchema');

// Get modules
const express = require('express');
const router  = express.Router();
const ServerEvent = require('./ServerEvent');


// -------------------------------------------------------------------------- //
//                                Router                                      //
// -------------------------------------------------------------------------- //

/**
 * ROUTE Get All Ingredients
 * @function
 * @name get/
 * @returns {Object} Get All ingredients object in database
 */
router.get('/', (req, res, next) => {
  getIngredients(req, res, next);
});

/**
 * ROUTE Get Ingredient by Id
 * @function
 * @name get/:ingredient_id
 * @returns {Object} Get specific ingredient with the given id
 */
router.get('/:ingredient_id', (req, res, next) => {
  getIngredientById(req, res, next);
});

/**
 * ROUTE Get Ingredient by name
 * @function
 * @name get/name/:name
 * @returns {Object} Get specific ingredient with the given name
 */
router.get('/name/:name', (req, res, next) => {
  getIngredientByName(req, res, next);
});

/**
 * ROUTE Get Ingredient by price
 * @function
 * @name get/price/:price
 * @returns {Object} Get specific ingredient with the given price
 */
router.get('/price/:price', (req, res, next) => {
  getIngredientByPrice(req, res, next);
});

/**
 * ROUTE Get Ingredient by pizza id
 * @function
 * @name get/pizzaid/:pizza_ids
 * @returns {Object} Get specific ingredient with the given pizza id
 */
router.get('/pizzaid/:pizza_ids', (req, res, next) => {
  getIngredientInPizza(req, res, next);
});

/**
 * ROUTE Get Ingredient by create
 * @function
 * @name get/created/:created_at
 * @returns {Object} Get specific ingredient with the given created_at
 */
router.get('/created/:created_at', (req, res, next) => {
  getIngredientCreatedAt(req, res, next);
});

/**
 * ROUTE Update Ingredient
 * @function
 * @name put/:ingredient_id'
 * @returns {Object} return the ingredient which was modify
 */
router.put('/:ingredient_id', (req, res, next) => {
  updateIngredient(req, res, next);
});

/**
 * ROUTE Create Ingredient
 * @function
 * @name post/
 * @returns {Object}  return the ingredient which was created
 */
router.post('/', (req, res, next) => {
  createIngredient(req, res, next);
});

/**
 * ROUTE Delete Ingredient
 * @function
 * @name delete/
 * @returns {Object}  return the ingredient which was deleted
 */
router.delete('/:ingredient_id', (req, res, next) => {
  deleteIngredient(req, res, next);
});


// -------------------------------------------------------------------------- //
//                              Functions                                     //
// -------------------------------------------------------------------------- //

/**
 * Get All Ingredient
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient values
 */
function getIngredients(req,res,next){
    ingredientSchema.find((err,ingredient) => {
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            res.status(200);
            res.send(ingredient);
        }
    next();
    });
}

/**
 * Get Ingredient by Id
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient value get by id
 */
function getIngredientById(req,res,next){
    ingredientSchema.findOne({_id: req.params.ingredient_id}, (err,ingredient) => {
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            res.status(200);
            res.send(ingredient);
        }
    next();
    }); 
}

/**
 * Get Ingredient by Name
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient value get by name
 */
function getIngredientByName(req,res,next){
    ingredientSchema.findOne({name: req.params.name}, (err,ingredient) => {
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            res.status(200);
            res.send(ingredient);
        }
    next();      
});
}

/**
 * Get Ingredient by Price
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient value get by price
 */
function getIngredientByPrice(req,res,next){
    ingredientSchema.find({price: req.params.price}, (err,ingredient) => {
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            res.status(200);
            res.send(ingredient);
        }
    next();      
    });
}

/**
 * Get Ingredient they are in a given pizza
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient value get by pizza id
 */
function getIngredientInPizza(req,res,next){
    ingredientSchema.find({pizza_ids: req.params.pizza_ids}, (err,ingredient) => {
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            res.status(200);
            res.send(ingredient);
        }
    next();      
    });
}


/**
 * Get Ingredient they are in a given pizza
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient value get by date of creation
 */
function getIngredientCreatedAt(req,res,next){
    ingredientSchema.find({create_at: req.params.created_at}, (err,ingredient) => {
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            res.status(200);
            res.send(ingredient);
        }
    next();      
    });
}


/**
 * Update an Ingredient
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient that was updated
 */
function updateIngredient(req,res,next){
    ingredientSchema.findOne({_id:req.params.ingredient_id}, (err,ingredient) =>{
        if(err){
            console.error(err);
            res.status(500);
            res.send(err); 
        }else{
            Object.assign(ingredient, req.body).save((err, ingredient) => {
                if(err){
                    console.error(err);
                    res.status(500);
                    res.send(err);
                }else{
                    ServerEvent.emit('ingredientUpdated', ingredient);      
                    res.status(200);    
                    res.send(ingredient);
                    global.io.emit('IngredientUpdated', ingredient);
                }
            next();  
            });    
        }
         
    });
}


/**
 * Create an Ingredient
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient that was created
 */
function createIngredient (req, res, next) {
  const newIngredient = new ingredientSchema(req.body);

  newIngredient.save((err, savedIngredient) => {
    if (err) {
      console.error(err);
      res.status(500);
      res.send(err);
    }
    else {
      ServerEvent.emit('ingredientCreated', savedIngredient);
      res.status(200);
      res.send(savedIngredient);
      global.io.emit('IngredientCreated', savedIngredient);
    }
  });
}

/**
 * Delete an Ingredient
 * @function
 * @param {Object} req - Express request object
 * @param {Object} res - Express response object
 * @param {Function} next - Express next middleware function
 * @return callback object represent ingredient that was deleted
 */
function deleteIngredient (req, res, next) {
  ingredientSchema.findOneAndRemove({_id: req.params.ingredient_id })
  .exec((err, removedIngredient) => { //exec allow us to execute a callback after we use the query builder
    if (err) {
        console.error(err);
        res.status(500);
        res.send(err);
    }
    else {
        ServerEvent.emit('ingredientDeleted', removedIngredient);
        res.status(200);
        res.send(removedIngredient);
        global.io.emit('IngredientDeleted', removedIngredient);
    }
  });
}
// -------------------------------------------------------------------------- //
//                                Events                                      //
// -------------------------------------------------------------------------- //
console.log('ingredientEvent is Ready !!!');

/**
 * @event Update Operation Ingredient
 * @param {Object} data - The result of update CRUD operation
 * @fires   Console log specify what is the updated object
 */
ServerEvent.on('ingredientUpdated', (data, socket) => {
   console.log(`This ingredient has been updated ${data}`);
});

/**
 * @event Create Operation Ingredient
 * @param {Object} data - The result of create CRUD operation
 * @fires   Console log specify what is the created object
 */
ServerEvent.on('ingredientCreated', (data, socket) => {
  console.log(`This ingredient has been created ${data}`);
});

/**
 * @event Delete Operation Ingredient
 * @param {Object} data - The result of delete CRUD operation
 * @fires   Console log specify what is the deleted object
 */
ServerEvent.on('ingredientDeleted', (data, socket) => {
  console.log(`This ingredient has been deleted ${data}`);
});


// Export
module.exports = router;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ControllerIngredient.html">ControllerIngredient</a></li><li><a href="module-ControllerPizza.html">ControllerPizza</a></li><li><a href="module-ModelIngredient.html">ModelIngredient</a></li><li><a href="module-ModelPizza.html">ModelPizza</a></li><li><a href="module-ServerEvent.html">ServerEvent</a></li></ul><h3>Classes</h3><ul><li><a href="module-ModelIngredient-Ingredient.html">Ingredient</a></li><li><a href="module-ModelPizza-Pizza.html">Pizza</a></li></ul><h3>Events</h3><ul><li><a href="module-ControllerIngredient.html#~event:CreateOperationIngredient">Create Operation Ingredient</a></li><li><a href="module-ControllerPizza.html#~event:CreateOperationPizza">Create Operation Pizza</a></li><li><a href="module-ControllerIngredient.html#~event:DeleteOperationIngredient">Delete Operation Ingredient</a></li><li><a href="module-ControllerPizza.html#~event:DeleteOperationPizza">Delete Operation Pizza</a></li><li><a href="module-ControllerIngredient.html#~event:UpdateOperationIngredient">Update Operation Ingredient</a></li><li><a href="module-ControllerPizza.html#~event:UpdateOperationPizza">Update Operation Pizza</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Nov 19 2017 21:12:58 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
